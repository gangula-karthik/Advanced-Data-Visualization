<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singapore Map Visualization</title>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, sans-serif;
            font-size: 14px;
            color: #333;
        }

        #content .info {
            height: auto; /* Make the tooltip height responsive to long text */
            padding: 5px;
            background-color: #f7f7f7;
            border: 1px solid #ddd;
            display: none; /* Initially hide the info box */
            position: absolute;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        #content .map path {
            fill: #aaa;
            stroke: #fff;
            stroke-width: 0.5;
        }

        #content .bounding-box rect {
            fill: none;
            stroke: #333;
            stroke-dasharray: 2, 1;
        }

        #content .centroid circle {
            fill: red;
        }
    </style>
</head>

<body>
    <div id="content">
        <div class="info">Hover over a district</div>
        <svg id="map" width="620px" height="600px">
            <g class="map"></g>
            <g class="bounding-box">
                <rect></rect>
            </g>
            <g class="centroid">
                <circle r="4"></circle>
            </g>
        </svg>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Adjusting projection for a smaller geographic area (Singapore)
        const projection = d3.geoMercator()
            .scale(50000)  // Increase scale for a smaller area
            .translate([310, 300])
            .center([103.851959, 1.290270]); // Singapore's approximate central coordinates

        const geoGenerator = d3.geoPath()
            .projection(projection);

        function handleMouseover(e, d) {
            const pixelArea = geoGenerator.area(d);
            const bounds = geoGenerator.bounds(d);
            const centroid = geoGenerator.centroid(d);
            const measure = geoGenerator.measure(d);
            const tooltip = d3.select('#content .info')
                .text(`${d.properties.planning_area} (${d.properties.district}) [area = ${pixelArea.toFixed(1)} measure = ${measure.toFixed(1)}]`)
                .style('display', 'inline') // Show the tooltip on mouseover
                .style('left', `${e.clientX}px`)
                .style('top', `${e.clientY}px`);

            d3.select('#content .bounding-box rect')
                .attr('x', bounds[0][0])
                .attr('y', bounds[0][1])
                .attr('width', bounds[1][0] - bounds[0][0])
                .attr('height', bounds[1][1] - bounds[0][1]);

            d3.select('#content .centroid')
                .attr('transform', 'translate(' + centroid + ')')
                .style('display', 'inline');
        }

        function handleMouseout() {
            d3.select('#content .info')
                .style('display', 'none'); // Hide the tooltip on mouseout
        }

        function update(geojson) {
            const u = d3.select('#content g.map')
                .selectAll('path')
                .data(geojson.features);

            u.enter()
                .append('path')
                .attr('d', geoGenerator)
                .on('mouseover', handleMouseover)
                .on('mouseout', handleMouseout) // Add mouseout event
                .style('cursor', 'pointer');

            u.exit().remove();
        }

        d3.json('./data/district_and_planning_area.geojson')
            .then(function (json) {
                update(json);
                console.log(json)
            })
            .catch(function (error) {
                console.error("Error loading the GeoJSON data: ", error);
                d3.select('#content .info')
                    .text('Failed to load Singapore map data');
            });
    </script>
</body>
</html>
